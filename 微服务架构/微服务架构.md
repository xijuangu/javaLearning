

# å¾®æœåŠ¡æ¶æ„

## æ¶æ„æ¼”åŒ–

### å•ä½“æ¶æ„

æ‰€æœ‰åŠŸèƒ½æ¨¡å—éƒ½å†™åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå¹¶åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œè¯¥é¡¹ç›®çš„jaråŒ…ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿçš„æœåŠ¡æ—¶ï¼Œä¼šæ ¹æ®åŸŸå/å…¬ç½‘IPç›´æ¥è®¿é—®éƒ¨ç½²äº†è¯¥ç³»ç»Ÿçš„æœåŠ¡å™¨ã€‚ä¼˜ç‚¹æ˜¯å¼€å‘ä¸éƒ¨ç½²ç›¸å¯¹æ›´ç®€å•ï¼Œç¼ºç‚¹æ˜¯ç³»ç»Ÿæ€§èƒ½å—å•å°æœåŠ¡å™¨æ€§èƒ½é™åˆ¶ï¼Œæ— æ³•å¤„ç†é«˜å¹¶å‘çš„ä»»åŠ¡ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥åˆ°é›†ç¾¤æ¶æ„ã€‚

### é›†ç¾¤æ¶æ„

å°†å•ä½“æ¶æ„ä¸­éƒ¨ç½²äº†è¯¥ç³»ç»Ÿçš„æœåŠ¡å™¨å¤åˆ¶ n ä»½ç§°ä¸º **å‰¯æœ¬**ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½å¯ä»¥å•ç‹¬å®Œæˆä¸€ä¸ªå®Œæ•´çš„ä»»åŠ¡ï¼Œè¿™æ ·çš„ n å°æœåŠ¡å™¨ç»„åˆèµ·æ¥å°±å« **é›†ç¾¤**ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨é›†ç¾¤æ¶æ„çš„ç³»ç»Ÿçš„æœåŠ¡æ—¶ï¼Œæ ¹æ®åŸŸå/å…¬ç½‘IPå…ˆè®¿é—®åˆ° **ç½‘å…³**ï¼ˆå¦‚ Nginxï¼‰ æ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œç„¶åç”±ç½‘å…³ä½¿ç”¨ **è´Ÿè½½å‡è¡¡** å°†è¯·æ±‚ **è·¯ç”±** ç»™é›†ç¾¤ä¸­çš„å‰¯æœ¬ï¼Œç½‘å…³å®é™…ä¸Šæ˜¯ *æ‰€æœ‰* è¯·æ±‚çš„å…¥å£ã€‚åŒæ ·çš„ï¼Œæ•°æ®åº“ä¹Ÿéœ€è¦æˆä¸ºæ•°æ®åº“é›†ç¾¤ä»¥æé«˜å¹¶å‘èƒ½åŠ›ã€‚é›†ç¾¤æ¶æ„çš„ä¼˜ç‚¹æ˜¾ç„¶å°±æ˜¯æé«˜äº†å¹¶å‘èƒ½åŠ›ï¼Œä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š1. ç³»ç»Ÿçš„æŸä¸ªæ¨¡å—å¦‚æœæœ‰ç»å¸¸å‡çº§çš„éœ€æ±‚ï¼Œé‚£ä¹ˆå³ä¾¿åªå‡çº§äº†ä¸€ä¸ªæ¨¡å—ï¼Œä¾ç„¶è¦åœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šé‡æ–°æ‰“åŒ…éƒ¨ç½²ï¼›2. å¦‚æœæœ‰ä½¿ç”¨å…¶ä»–ç”Ÿæ€/è¯­è¨€ç¼–å†™çš„åŠŸèƒ½ï¼Œåˆ™å¾ˆéš¾å¹¶å…¥åŸé¡¹ç›®ã€‚å› æ­¤æˆ‘ä»¬å°±æ¥åˆ°äº†åˆ†å¸ƒå¼æ¶æ„ã€‚

### åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„

æ¯ä¸€å°æœåŠ¡å™¨ä¸å†éƒ¨ç½²ä¸€æ•´ä¸ªç³»ç»Ÿï¼Œè€Œæ˜¯éƒ¨ç½²ä»ç³»ç»Ÿä¸­æ‹†åˆ†å‡ºæ¥çš„å„ä¸ªå¾®æœåŠ¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸èƒ½ **åª** åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ª **ç›¸åŒçš„** åŠŸèƒ½æ¨¡å—ï¼Œè¿™æ ·ä¼šå¯¼è‡´ **å•ç‚¹æ•…éšœ** æ—¶æ•´ä¸ªç³»ç»Ÿéƒ½ä¸å¯ç”¨ã€‚å„ä¸ªå¾®æœåŠ¡åªè¿æ¥/æ“ä½œè‡ªå·±çš„æ•°æ®åº“/è¡¨ï¼Œå¦‚æœéœ€è¦è·å–å…¶ä»–å¾®æœåŠ¡çš„æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œåªåº”å‘è¯¥å¾®æœåŠ¡è¯·æ±‚**ï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨--RPCï¼‰**ï¼Œä¸åº”è‡ªå·±å»æ•°æ®åº“ä¸­è·å–ã€‚å¾®æœåŠ¡ä¹‹é—´é€šè¿‡ **æ³¨å†Œä¸­å¿ƒ** æ¥è¿›è¡Œ **æœåŠ¡æ³¨å†Œ** ä¸ **æœåŠ¡å‘ç°**ï¼Œå¾®æœåŠ¡ä¸Šçº¿æ—¶ï¼Œéœ€è¦å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡ï¼Œè¿œç¨‹è°ƒç”¨æ—¶ï¼Œéœ€è¦å…ˆå»æ³¨å†Œä¸­å¿ƒå‘ç°æœåŠ¡ã€‚æ³¨å†Œä¸­å¿ƒé€šå¸¸å…¼æœ‰ **é…ç½®ä¸­å¿ƒ**ï¼Œå„ä¸ªå¾®æœåŠ¡çš„é…ç½®éƒ½åœ¨é…ç½®ä¸­å¿ƒä¿å­˜ï¼Œåœ¨é…ç½®ä¸­å¿ƒå¯ä»¥ç»Ÿä¸€ä¿®æ”¹æ‰€æœ‰é…ç½®å¹¶æ¨é€åˆ°å„ä¸ªå¾®æœåŠ¡ï¼Œä¸”å¯ä»¥çƒ­æ›´æ–°é…ç½®ã€‚å¦å¤–ï¼Œå¾®æœåŠ¡æ¶æ„è¿˜éœ€è¦ **ç†”æ–­** æœºåˆ¶ï¼Œé¦–å…ˆè€ƒè™‘ä¸€ä¸ªç°è±¡ï¼šä¸€ä¸ªç”¨æˆ·åœ¨ç›´æ’­é—´è´­ä¹°å•†å“ï¼Œé‚£ä¹ˆä»–è‡³å°‘è¦ç”± [ç›´æ’­] è°ƒç”¨ [è®¢å•]ï¼Œç„¶å [è®¢å•] è°ƒç”¨ [æ”¯ä»˜]ï¼Œé‚£ä¹ˆå¦‚æœæ­¤æ—¶ [æ”¯ä»˜] å¡äº†ï¼Œä¼šé€ æˆä»€ä¹ˆåæœï¼Ÿç­”ï¼šå¤§é‡è¯·æ±‚ç”±äºæ— æ³•å¤„ç†ã€å¾—ä¸åˆ°å“åº”ä¼šä¸æ–­å †ç§¯ï¼Œå¯¼è‡´ä» [ç›´æ’­] åˆ° [æ”¯ä»˜] æ•´ä¸ªè°ƒç”¨é“¾ä¸­çš„æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œæœ€ç»ˆå¯¼è‡´ **æœåŠ¡é›ªå´©**ã€‚è€Œç†”æ–­æœºåˆ¶çš„ç›®çš„å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç†”æ–­ä¸­é…ç½®ï¼šå¦‚æœå‘æŸä¸ªå¾®æœåŠ¡å‘é€çš„è¯·æ±‚5ç§’å†…è¶…è¿‡50%éƒ½å‘ç”Ÿäº†å¡é¡¿ï¼Œé‚£ä¹ˆäº”ç§’åå‘è¯¥å¾®æœåŠ¡å‘é€çš„è¯·æ±‚å…¨éƒ¨è·³è¿‡å‘é€ï¼Œ**å¿«é€Ÿå¤±è´¥**ï¼ŒåŠæ—¶é‡Šæ”¾èµ„æºã€‚

ç”¨æˆ·åœ¨ä½¿ç”¨ç³»ç»Ÿçš„æœåŠ¡æ—¶ï¼ŒåŒæ ·éœ€è¦å…ˆå°†è¯·æ±‚å‘é€è‡³ç½‘å…³ï¼Œåœ¨ç½‘å…³ä¸­éœ€è¦å…ˆå¯¹è¯·æ±‚è·¯å¾„è¿›è¡Œé…ç½®ï¼Œä¾‹å¦‚ /order/xxx è§„å®šä¸ºè¦å‘é€ç»™ [è®¢å•] çš„è¯·æ±‚ï¼Œç„¶åç½‘å…³ä¼šè¯¢é—®æ³¨å†Œä¸­å¿ƒæ‰¾åˆ° [è®¢å•] å¹¶è½¬å‘è¯·æ±‚ã€‚

æ­¤å¤–ï¼Œç”±äºå„ä¸ªå¾®æœåŠ¡éƒ½å„è‡ªè¿æ¥å„è‡ªçš„æ•°æ®åº“ï¼Œå°±ä¸èƒ½åƒå•æ•°æ®åº“é‚£æ ·å¯¹äº‹åŠ¡è¿›è¡Œç®¡ç†ã€‚å¯¹äºåˆ†å¸ƒå¼äº‹åŠ¡å°±éœ€è¦å¦å¤–çš„è§£å†³æ–¹æ¡ˆã€‚

å› æ­¤ä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„éœ€è¦æœ‰ï¼šå¾®æœåŠ¡ Springbootã€æ³¨å†Œä¸­å¿ƒ/é…ç½®ä¸­å¿ƒ Nacosã€ç½‘å…³ SpringCloud Gatewayã€è¿œç¨‹è°ƒç”¨ OpenFeignã€æœåŠ¡ç†”æ–­ Sentinelã€åˆ†å¸ƒå¼äº‹åŠ¡ Seata

## Nacos

### é…ç½®

**é…ç½®**æ˜¯æŒ‡ç³»ç»Ÿè¿è¡Œæ‰€éœ€çš„ã€**å¯å˜çš„å‚æ•°æˆ–ä¿¡æ¯**ï¼Œè¿™äº›ä¿¡æ¯**ä¸æ˜¯å†™æ­»åœ¨ä»£ç ä¸­**ï¼Œè€Œæ˜¯ä»¥æŸç§å½¢å¼**å¤–éƒ¨æä¾›**ï¼Œå¦‚ï¼š

- æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ˆåœ°å€ã€ç”¨æˆ·åã€å¯†ç ï¼‰
- Redisã€MQ çš„åœ°å€
- æ—¥å¿—çº§åˆ«ï¼ˆdebug/infoï¼‰
- ç¬¬ä¸‰æ–¹æœåŠ¡çš„ API key
- å½“å‰è¿è¡Œç¯å¢ƒï¼ˆdev/test/prodï¼‰

**ä¸ºä»€ä¹ˆè¦é…ç½®ï¼Ÿ**

1. **ä»£ç ä¸ç¯å¢ƒè§£è€¦**ï¼šä¸æŠŠç¯å¢ƒå‚æ•°å†™æ­»åœ¨ä»£ç ä¸­ï¼Œæ›´çµæ´»ã€‚
2. **æ–¹ä¾¿éƒ¨ç½²**ï¼šä¸åŒç¯å¢ƒåªéœ€è¦æ”¹é…ç½®ï¼Œä¸ç”¨æ”¹ä»£ç ã€‚
3. **æ–¹ä¾¿ä¿®æ”¹**ï¼šæœ‰æ—¶ä½ åªæƒ³æ”¹ä¸€ä¸ªæ•°æ®åº“åœ°å€ï¼Œä¸æƒ³é‡æ–°æ‰“åŒ…éƒ¨ç½²ä»£ç ã€‚
4. **æé«˜å®‰å…¨æ€§**ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰ä¸ç›´æ¥æš´éœ²åœ¨æºç é‡Œã€‚

#### é…ç½®ä¼˜å…ˆçº§

Spring Boot ä¼šæŒ‰ä¸‹é¢çš„é¡ºåºåŠ è½½é…ç½®æ–‡ä»¶ï¼š**â€œå‘½ä»¤è¡Œ > æœ¬åœ° config/ > æœ¬åœ°æ ¹ç›®å½• > Nacos > jar å†… > ä»£ç é»˜è®¤â€** 

| ä¼˜å…ˆçº§ | é…ç½®æ¥æº                                                     | è¯´æ˜                                      |
| ------ | ------------------------------------------------------------ | ----------------------------------------- |
| **1ï¸âƒ£**  | **å‘½ä»¤è¡Œå‚æ•°** `--server.port=8081`                          | æœ€é«˜ä¼˜å…ˆçº§                                |
| **2ï¸âƒ£**  | **`SPRING_APPLICATION_JSON`**                                | ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿå±æ€§ä¸­çš„ JSON é…ç½®          |
| **3ï¸âƒ£**  | **æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡** å¦‚ `SERVER_PORT=8081`                   |                                           |
| **4ï¸âƒ£**  | **JVM ç³»ç»Ÿå±æ€§** `-Dserver.port=8081`                        |                                           |
| **5ï¸âƒ£**  | **`config/` ç›®å½•ä¸‹çš„ `application-{profile}.yml`** ï¼ˆå¦‚ `./config/application-prod.yml`ï¼‰ |                                           |
| **6ï¸âƒ£**  | **åŒçº§ç›®å½•ä¸‹çš„ `application-{profile}.yml`** ï¼ˆå¦‚ `./application-prod.yml`ï¼‰ |                                           |
| **7ï¸âƒ£**  | **`config/` ç›®å½•ä¸‹çš„ `application.yml`** ï¼ˆå¦‚ `./config/application.yml`ï¼‰ |                                           |
| **8ï¸âƒ£**  | **åŒçº§ç›®å½•ä¸‹çš„ `application.yml`** ï¼ˆå¦‚ `./application.yml`ï¼‰ |                                           |
| **9ï¸âƒ£**  | **Nacos é…ç½®ä¸­å¿ƒ** ï¼ˆé€šè¿‡ `bootstrap.yml` åŠ è½½ï¼‰             | ğŸ”¥ **å…³é”®ï¼šNacos åœ¨è¿™é‡Œï¼é«˜äº jar å†…é…ç½®** |
| **ğŸ”Ÿ**  | **jar åŒ…å†…çš„ `application-{profile}.yml`** ï¼ˆ`classpath:/config/application-prod.yml`ï¼‰ |                                           |
| **1ï¸âƒ£1ï¸âƒ£** | **jar åŒ…å†…çš„ `application.yml`** ï¼ˆ`classpath:/application.yml`ï¼‰ |                                           |
| **1ï¸âƒ£2ï¸âƒ£** | **ä»£ç ä¸­çš„é»˜è®¤å€¼** ï¼ˆ`@Value("${x:y}")` ä¸­çš„ `y`ï¼Œæˆ– `@ConfigurationProperties` å­—æ®µåˆå§‹å€¼ï¼‰ | æœ€ä½ä¼˜å…ˆçº§                                |

å…¶ä¸­ï¼Œé«˜ä¼˜å…ˆçº§ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§ï¼Œä¹Ÿå³ï¼Œåè¯»å–çš„é…ç½®é¡¹å¦‚æœä¹‹å‰å·²ç»è¢«è¯»å…¥ï¼Œå°±ä¼šè¢«èˆå¼ƒ

### é…ç½®ä¸­å¿ƒ

é…ç½®ä¸­å¿ƒæ˜¯ä¸€ä¸ª**é›†ä¸­å¼çš„é…ç½®ç®¡ç†å¹³å°**ï¼Œå®ƒï¼š

- å°†é…ç½®é›†ä¸­å­˜å‚¨åœ¨ä¸€ä¸ªåœ°æ–¹ï¼ˆå¦‚æœåŠ¡ç«¯ï¼‰
- æ”¯æŒ**ç»Ÿä¸€ç®¡ç†ã€ç»Ÿä¸€ä¸‹å‘**é…ç½®
- æ”¯æŒ**åŠ¨æ€åˆ·æ–°é…ç½®**ï¼ˆä¸é‡å¯æœåŠ¡ï¼‰
- æœ‰æƒé™æ§åˆ¶ã€ç‰ˆæœ¬å›æ»šã€ç¯å¢ƒéš”ç¦»ç­‰èƒ½åŠ›

åœ¨**å•ä½“ç³»ç»Ÿ**ä¸­ï¼Œç”¨æœ¬åœ°é…ç½®æ–‡ä»¶è¿˜å¤Ÿç”¨ï¼Œä½†åœ¨**å¾®æœåŠ¡æ¶æ„**ä¸­ï¼Œæœ‰å‡ åä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿˜æœ‰å¤šä¸ªç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€é¢„å‘ã€ç”Ÿäº§ï¼‰â€”â€”è¿™æ—¶å°±å‡ºç°é—®é¢˜äº†ï¼š

- é…ç½®åˆ†æ•£ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†
- æ”¹ä¸€ä¸ªé…ç½®ï¼Œè¦å»ä¸€å †æœºå™¨ä¸Šæ”¹æ–‡ä»¶
- é…ç½®æ”¹é”™å®¹æ˜“å¯¼è‡´ç³»ç»ŸæŒ‚æ‰
- ä¸æ”¯æŒåŠ¨æ€åˆ·æ–°ï¼ˆéœ€è¦é‡å¯ï¼‰

### Nacos ä»‹ç»

**Nacos** æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ª**æœåŠ¡å‘ç° + é…ç½®ç®¡ç†**çš„ä¸­é—´ä»¶å¹³å°ï¼Œåå­—æ¥æºäºï¼š

> **Na**ming + **Co**nfiguration + **S**ervice = **Nacos**

å®ƒæ”¯æŒä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **é…ç½®ä¸­å¿ƒ**ï¼šç”¨äºç®¡ç†å¾®æœåŠ¡çš„é…ç½®ï¼ˆå¯åŠ¨æ€åˆ·æ–°ï¼‰
2. **æœåŠ¡æ³¨å†Œä¸å‘ç°**ï¼šç”¨äºæœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨æ—¶è‡ªåŠ¨å‘ç°å½¼æ­¤ï¼ˆé€‚ç”¨äº Spring Cloud / Dubbo ç­‰ï¼‰

ç‰¹æ€§ï¼š

1. **æœåŠ¡å‘ç°ä¸æœåŠ¡å¥åº·æ£€æŸ¥**

â€‹    Nacosä½¿æœåŠ¡æ›´å®¹æ˜“æ³¨å†Œï¼Œå¹¶é€šè¿‡DNSæˆ–HTTPæ¥å£å‘ç°å…¶ä»–æœåŠ¡ï¼ŒNacosè¿˜æä¾›æœåŠ¡çš„å®æ—¶å¥åº·æ£€æŸ¥ï¼Œä»¥é˜²

â€‹    æ­¢å‘ä¸å¥åº·çš„ä¸»æœºæˆ–æœåŠ¡å®ä¾‹å‘é€è¯·æ±‚ã€‚

2. **åŠ¨æ€é…ç½®ç®¡ç†**

â€‹    åŠ¨æ€é…ç½®æœåŠ¡å…è®¸æ‚¨åœ¨æ‰€æœ‰ç¯å¢ƒä¸­ä»¥é›†ä¸­å’ŒåŠ¨æ€çš„æ–¹å¼ç®¡ç†æ‰€æœ‰æœåŠ¡çš„é…ç½®ã€‚Nacosæ¶ˆé™¤äº†åœ¨æ›´æ–°é…ç½®æ—¶é‡æ–°

â€‹    éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œè¿™ä½¿é…ç½®çš„æ›´æ”¹æ›´åŠ é«˜æ•ˆå’Œçµæ´»ã€‚

3. **åŠ¨æ€DNSæœåŠ¡**

â€‹    Nacosæä¾›åŸºäºDNSåè®®çš„æœåŠ¡å‘ç°èƒ½åŠ›ï¼Œæ—¨åœ¨æ”¯æŒå¼‚æ„è¯­è¨€çš„æœåŠ¡å‘ç°ï¼Œæ”¯æŒå°†æ³¨å†Œåœ¨Nacosä¸Šçš„æœåŠ¡ä»¥åŸŸ

â€‹    åçš„æ–¹å¼æš´éœ²ç«¯ç‚¹ï¼Œè®©ä¸‰æ–¹åº”ç”¨æ–¹ä¾¿çš„æŸ¥é˜…åŠå‘ç°ã€‚

4. **æœåŠ¡å’Œå…ƒæ•°æ®ç®¡ç†**

â€‹    Nacosèƒ½è®©æ‚¨ä»å¾®æœåŠ¡å¹³å°å»ºè®¾çš„è§†è§’ç®¡ç†æ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰æœåŠ¡åŠå…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ç®¡ç†æœåŠ¡çš„æè¿°ã€ç”Ÿå‘½å‘¨

â€‹    æœŸã€æœåŠ¡çš„é™æ€ä¾èµ–åˆ†æã€æœåŠ¡çš„å¥åº·çŠ¶æ€ã€æœåŠ¡çš„æµé‡ç®¡ç†ã€è·¯ç”±åŠå®‰å…¨ç­–ç•¥ã€‚

### å¿«é€Ÿå¯åŠ¨â€”â€”æ³¨å†Œä¸­å¿ƒ

#### ä½œä¸ºæœåŠ¡æ³¨å†Œåˆ° Nacos

1. å¯¼å…¥ç›¸å…³ä¾èµ–

2. ä½œä¸º web åº”ç”¨ï¼Œè‡ªç„¶éœ€è¦é…ç½® `spring.application.name` ä¸ `server.port` 
3. é…ç½®æ³¨å†Œä¸­å¿ƒæœåŠ¡å™¨åœ°å€ä¸ç«¯å£å· `spring.cloud.nacos.server-addr`ï¼Œé»˜è®¤å€¼ä¸º `127.0.0.1:8848`
4. è¿›å…¥ Nacos çš„ web ui æŸ¥çœ‹ï¼Œåœ¨ æœåŠ¡ç®¡ç†-æœåŠ¡åˆ—è¡¨ ä¸‹å¯æŸ¥çœ‹æ³¨å†Œåˆ° Nacos çš„æœåŠ¡ï¼Œå…¶ä¸­æœåŠ¡åå°±æ˜¯ web åº”ç”¨çš„ `spring.application.name`ï¼ŒæœåŠ¡åä¸åˆ†ç»„å”¯ä¸€ç¡®å®šä¸€ä¸ªæœåŠ¡
5. åœ¨æ¯ä¸ªæœåŠ¡åç‚¹å‡»è¯¦æƒ…å¯ä»¥çœ‹åˆ°ï¼ŒNacos è®°å½•äº†è¯¥æœåŠ¡çš„é›†ç¾¤çš„ ipã€ç«¯å£ã€å¥åº·çŠ¶æ€ã€å…ƒæ•°æ®ç­‰ã€‚å¦‚æœé›†ç¾¤ä¸­æœºå™¨æ•°é‡å¤§äº1ï¼Œå°±å¯èƒ½æ¶‰åŠåˆ°è´Ÿè½½å‡è¡¡ç­‰é›†ç¾¤æ¨¡å¼ä¸‹éœ€è¦è€ƒè™‘çš„é—®é¢˜

#### ä½œä¸ºå®¢æˆ·ç«¯å‘ç° Nacos ä¸Šçš„æœåŠ¡

1. åœ¨å®¢æˆ·ç«¯çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ `@EnableDiscoveryClient`

2. è¿›è¡Œè¿œç¨‹è°ƒç”¨

   - [ ] a. è·å–æœåŠ¡æ‰€åœ¨çš„æ‰€æœ‰æœºå™¨ IP ä¸ port
     - ä½¿ç”¨ Spring Cloud æä¾›çš„æœåŠ¡å‘ç° DiscoveryClient æˆ– Nacos çš„æœåŠ¡å‘ç° API éƒ½å¯ï¼Œè¿™é‡Œç”¨ DiscoveryClientã€‚DiscoveryClient çš„å®ä¾‹ä½¿ç”¨ `@Autowired` è‡ªåŠ¨æ³¨å…¥è·å–
     - è°ƒç”¨ `discoveryClient.getInstances(String serviceId)` è·å–è¯¥æœåŠ¡çš„æ‰€æœ‰å®ä¾‹çš„ List åˆ—è¡¨ï¼Œç„¶åå¯ä»¥é€šè¿‡å…¶ä¸­ä»»æ„å®ä¾‹çš„ `.getHost()` æ–¹æ³•ä¸ `.getPort()` æ–¹æ³•è·å–ä¸€ä¸ª ip ä¸ port
     - è¿™é‡Œçš„ serviceId å°±æ˜¯ Nacos ä¸­å¯ä»¥çœ‹åˆ°çš„æœåŠ¡å
   - [ ] b. æ‹¼æ¥ urlï¼Œæ­¤ url å°±æ˜¯è¦å‘è¯¥æœåŠ¡å‘é€ http è¯·æ±‚çš„ urlã€‚
     - è¿™é‡Œæœ‰ä¸€ä¸ªæœ€ç®€å•çš„å®ç°æ–¹å¼ï¼Œå°±æ˜¯åœ¨ä¸Šé¢è·å¾—çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ä¸­ç›´æ¥ `get(0)` å–ç¬¬ä¸€ä¸ªï¼Œ***è‡³äºè´Ÿè½½å‡è¡¡çš„åœºæ™¯åé¢å†è¯´ã€‚***
   - [ ] c. å‘é€è¿œç¨‹è¯·æ±‚
     - ä½¿ç”¨ Spring æä¾›çš„ RestTemplate å‘é€è¿œç¨‹è¯·æ±‚ï¼Œæœ€ä½³å®è·µæ˜¯åœ¨é…ç½®ç±»ä¸­è¿”å›ä¸€ä¸ªå…¨å±€éƒ½å¯ä½¿ç”¨çš„ RestTemplate Beanã€‚
     - ä½¿ç”¨ `restTemplate.getForObject(String url, Class clazz)` æ–¹æ³•å‘é€è¿œç¨‹è¯·æ±‚å¹¶å°†è¿”å›çš„ json æ•°æ®è½¬æ¢ä¸ºå¯¹è±¡

   > å…¶å®åœ¨ ***â€œè°ƒç”¨ `discoveryClient.getInstances(String serviceId)` è·å–è¯¥æœåŠ¡çš„æ‰€æœ‰å®ä¾‹çš„ List åˆ—è¡¨â€*** è¿™ä¸€æ­¥ä¸­ï¼Œè¿˜æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„ä¸œè¥¿ã€‚ä¾‹å¦‚ï¼Œå¯¹äº Nacos æ¥è¯´ï¼Œå®ƒæ˜¯é€šè¿‡ serviceId å’Œ group æ¥å”¯ä¸€ç¡®å®šä¸€ä¸ªæœåŠ¡çš„ï¼Œä½†æ˜¯ä¸Šé¢è¿™ä¸ªæ–¹æ³•åªèƒ½ä¼ å…¥ serviceIdï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé‡åˆ°éœ€è¦åŒºåˆ† group çš„åœºæ™¯ï¼Œå°±å¿…é¡»é€‰æ‹© Nacos æä¾›çš„ APIï¼Œè€Œä¸èƒ½ç®€å•åœ°ä½¿ç”¨ Spring æä¾›çš„ DiscoveryClient

![image-20250805153314142](.\image-20250805153314142.png)

#### è´Ÿè½½å‡è¡¡åœºæ™¯

##### æ–¹æ³•ä¸€

1. å¼•å…¥è´Ÿè½½å‡è¡¡ä¾èµ–
2. `autowired` è‡ªåŠ¨æ³¨å…¥ä¸€ä¸ª `LoadBalancerClient` å¯¹è±¡
3. `loadBalancerClient.choose(String serviceId)` æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œä¸åŒäºä¸Šé¢çš„ `discoeveryClient.getInstance()` æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€éœ€è¦è‡ªå·±å†™è´Ÿè½½å‡è¡¡ç®—æ³•
4. åŒä¸Šï¼Œæ‹¼æ¥ urlï¼Œç„¶åç”¨ `restTemplate.getForObject(String url, Class clazz)` å‘é€è¿œç¨‹è¯·æ±‚

##### æ–¹æ³•äºŒ

ä½¿ç”¨ `@LoadBalanced` æ³¨è§£

1. å¼•å…¥è´Ÿè½½å‡è¡¡ä¾èµ–
2. åœ¨éœ€è¦è°ƒç”¨ rpc çš„æ–¹æ³•ä¸ŠåŠ ä¸Š `@LoadBalanced` æ³¨è§£
3. ç›´æ¥æ‹¼æ¥ urlï¼Œå½¢å¦‚ï¼š`"http://service-product/product/" + productId`ï¼Œè¿™é‡Œçš„ `service-product` æ˜¯å¾®æœåŠ¡åï¼Œåœ¨ `restTemplate` ä¸­ä¼šè¢«è‡ªåŠ¨æ›¿æ¢ä¸ºè¯¥å¾®æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹çš„ ip ä¸ ç«¯å£

#### é¢è¯•é¢˜

1. å¦‚æœæ³¨å†Œä¸­å¿ƒå®•æœºï¼Œè¿œç¨‹è°ƒç”¨è¿˜èƒ½æˆåŠŸå—

   é¦–å…ˆï¼Œè°ƒç”¨æ–¹éœ€è¦å…ˆé€šè¿‡å¾®æœåŠ¡çš„åå­—å‘æ³¨å†Œä¸­å¿ƒè·å–è¯¥å¾®æœåŠ¡çš„è®¿é—®åœ°å€åˆ—è¡¨ï¼Œç„¶ååœ¨æœ¬åœ°é€šè¿‡è´Ÿè½½å‡è¡¡é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå®ä¾‹ï¼Œå‘å®ƒå‘èµ·è¯·æ±‚ï¼ŒåŒæ—¶ä¼šå°†è¿™ä¸ªå®ä¾‹åˆ—è¡¨å­˜å…¥æœ¬åœ°çš„ **å®ä¾‹ç¼“å­˜**ã€‚å› æ­¤ï¼Œè¿™ä¸ªé—®é¢˜éœ€è¦åˆ†æƒ…å†µï¼šå½“è°ƒç”¨æ–¹ä¹‹å‰è°ƒç”¨è¿‡è¿™ä¸ªå¾®æœåŠ¡ï¼Œå³ä½¿æ³¨å†Œä¸­å¿ƒå®•æœºäº†ï¼Œä¹Ÿå¯ä»¥ä»å®ä¾‹ç¼“å­˜ä¸­è·å–ä¸€ä¸ªå®ä¾‹æ¥è°ƒç”¨ï¼Œä½†å¦‚æœåœ¨æ³¨å†Œä¸­å¿ƒå®•æœºçš„è¿‡ç¨‹ä¸­è¿™ä¸ªå®ä¾‹ä¹Ÿå®•æœºäº†ï¼Œé‚£å°±ä¼šç›´æ¥è¯·æ±‚å¤±è´¥ï¼›è€Œå¦‚æœä¹‹å‰æ²¡è°ƒç”¨è¿‡ï¼Œé‚£å°±æ— æ³•è°ƒç”¨äº†

   **è´Ÿè½½å‡è¡¡å®Œå…¨åœ¨è°ƒç”¨æ–¹æœ¬åœ°åŸºäºç¼“å­˜çš„å®ä¾‹åˆ—è¡¨è¿›è¡Œï¼›Nacos çš„æ ¸å¿ƒä½œç”¨æ˜¯åœ¨æœåŠ¡å®ä¾‹å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆä¸Šçº¿/ä¸‹çº¿ï¼‰ï¼Œé€šè¿‡æ¨é€æˆ–æ‹‰å–æœºåˆ¶æ›´æ–°å®¢æˆ·ç«¯çš„æœ¬åœ°ç¼“å­˜ï¼Œä»è€Œé—´æ¥å½±å“åç»­çš„è´Ÿè½½å‡è¡¡ç»“æœã€‚** 

### å¿«é€Ÿå¯åŠ¨â€”â€”é…ç½®ä¸­å¿ƒ

#### æ–¹æ³•ä¸€

1. å¼•å…¥ç›¸å…³ä¾èµ–
2. åœ¨ nacos ä¸­æ–°å»ºé…ç½®ï¼Œ`DATA ID` å¯å†™å½¢å¦‚ `service-order.properties`ï¼Œé…ç½®å†…å®¹åŒ `application.yml` çš„å†™æ³•
3. åœ¨ application é…ç½®æ–‡ä»¶ä¸­é…ç½® `spring.cloud.nacos.server-addr` ä¸ `spring.config.import`ï¼Œå‰è€…æ˜¯ Nacos çš„ ip ä¸ç«¯å£å·ï¼Œåè€…æ˜¯æœ¬åº”ç”¨è¦è¯»å–çš„ Nacos ä¸Šçš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ `spring.config.import=nacos:service-order.properties`
4. åœ¨ application é…ç½®æ–‡ä»¶ä¸­é…ç½® `spring.cloud.nacos.config.import-check.enabled=false`ï¼Œä»¥å…³é—­æ£€æŸ¥ã€‚è¿™ä¸ªæ£€æŸ¥ä¼šåœ¨å¼•å…¥ nacos-config ç›¸å…³ä¾èµ–çš„é¡¹ç›®ä¸­æ£€æŸ¥æ˜¯å¦è¯»å–äº† Nacos ä¸Šçš„é…ç½®ï¼Œå¦‚æœæ²¡æœ‰å°±æŠ¥é”™ã€‚æˆ–è€…ä¹Ÿå¯ä»¥é€‰æ‹© `spring.config.import=optional:nacos:service-order.properties` åœ¨ä¸­é—´åŠ ä¸€ä¸ª optional
5. åœ¨éœ€è¦ç”¨åˆ° Nacos ä¸Šçš„é…ç½®æ–‡ä»¶çš„ç±»ä¸Šæ·»åŠ æ³¨è§£ `@RefreshScope`ï¼Œä»¥æ¿€æ´» **è‡ªåŠ¨åˆ·æ–°** åŠŸèƒ½

#### æ–¹æ³•äºŒ

1. åŒæ–¹æ³•ä¸€çš„1/2/3/4
2. æ–°å»ºä¸€ä¸ª Properties ç±»ï¼Œåœ¨å…¶ä¸­å†™å…¥éœ€è¦ä» Nacos ä¸­è¯»å–çš„å­—æ®µï¼Œç„¶åæ·»åŠ  `@Data`ã€`@Component`ã€`@ConfigurationProperties(prefix = "value")` ä¸‰ä¸ªæ³¨è§£ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªæ³¨è§£ä¸­çš„ prefix çš„å€¼å°±æ˜¯ Nacos ä¸­å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„å‰ç¼€ï¼Œä¾‹å¦‚ `value.timeout=1000` ä¸­çš„ value å°±æ˜¯å‰ç¼€
3. åœ¨éœ€è¦è¯»å–é…ç½®é¡¹çš„å€¼æ—¶ï¼Œå°±å…ˆè‡ªåŠ¨æ³¨å…¥ä¸€ä¸ª Properties çš„ Beanï¼Œç„¶åè°ƒç”¨ `properties.getTimeout()` æ–¹æ³•å³å¯è·å– `value.timeout` é…ç½®çš„å€¼

æ–¹æ³•äºŒè¿™ç§æ–¹å¼å¯ä»¥æ— éœ€ `@RefreshScope` å®ç°è‡ªåŠ¨åˆ·æ–°ï¼Œå› æ­¤æ›´æ¨è

#### ä¸»åŠ¨ç›‘å¬å˜åŒ–çš„é…ç½®é¡¹

1. åœ¨å¯åŠ¨ç±»ä¸­æ–°å»ºä¸€ä¸ªè¿”å› ApplicationRunner çš„ `@Bean` æ–¹æ³•ï¼Œæ­¤å¤„ä¸åšæ›´å¤šè§£é‡Šã€‚è¯¥æ–¹æ³•ä¼ å‚ä¸º NacosConfigManager ç±»çš„å¯¹è±¡ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤º

2. ```java
   @Bean
   ApplicationRunner applicationRunner(NacosConfigManager nacosConfigManager){
       return args -> {
           ConfigService configService = nacosConfigManager.getConfigService();
           configService.addListener("é…ç½®æ–‡ä»¶å", "åˆ†ç»„å", new Listener() {
               @OverRide
               public Executor getExecutor(){
                   return Executors.newFixedThreadPool(4);
               }
   
               @OverRide
               public void receiveConfigInfo(String configInfo) {
                   // æ¨¡æ‹Ÿé‚®ä»¶é€šçŸ¥é…ç½®å˜åŒ–
                   System.out.println("å˜åŒ–çš„é…ç½®ä¿¡æ¯ï¼š" + configInfo);
                   System.out.println("å‘é€é‚®ä»¶é€šçŸ¥é…ç½®å˜åŒ–...");
               }
           })
       }
   }
   ```

#### é¢è¯•é¢˜

1. é…ç½®çš„ä¼˜å…ˆçº§ï¼Ÿ

   è§ä¸Šé¢çš„ [é…ç½®ä¼˜å…ˆçº§è¡¨æ ¼](#é…ç½®ä¼˜å…ˆçº§)ï¼Œä½†æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šåœ¨ `spring.config.import=...` ä¸­ï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å¯¼å…¥å¤šä¸ªé…ç½®ï¼Œè¿™é‡Œçš„ä¼˜å…ˆçº§æ˜¯éµå¾ªå…ˆå¯¼å…¥ä¼˜å…ˆçš„ï¼Œä¹Ÿå°±æ˜¯æ’åœ¨å‰é¢çš„ä¼˜å…ˆï¼Œåé¢çš„è¢«è¦†ç›–

#### æ•°æ®éš”ç¦»

ä¸€ä¸ª `namespace` ä¸­æœ‰å¤šä¸ª `group`ï¼Œæ¯ä¸ª `group` ä¸€èˆ¬ä»£è¡¨ä¸€ä¸ªå¾®æœåŠ¡ï¼Œæ¯ä¸ª `group` ä¸­åˆæœ‰å¤šä¸ª `data-id`ï¼Œ`data-id` å°±æ˜¯é…ç½®æ–‡ä»¶åã€‚ä¸€ä¸ª `namespace` ä¸€èˆ¬ä»£è¡¨ä¸€å¥—ç¯å¢ƒï¼Œä¾‹å¦‚ `dev`ã€`test`ã€`prod` ç¯å¢ƒ

ä¹‹å‰çš„`spring.config.import=nacos:service-order.properties` é»˜è®¤è¯»å–çš„æ˜¯ `public` `namespace` ä¸‹çš„é…ç½®ï¼Œå¦‚æœè¦é€‰æ‹©è¯»å–çš„ `namespace` çš„è¯ï¼š

```yml
server:
	port: 8080
spring:
	application:
		name: service-order			# è¦æ³¨å†Œä¸ºçš„å¾®æœåŠ¡å
	cloud: 
		nacos:
			server-addr: 127.0.0.1:8848
			config:
				namespace: dev		# é€‰æ‹©å‘½åç©ºé—´
	config:
		import:
			# ç±»ä¼¼ http è¯·æ±‚ä¼ å‚çš„å½¢å¼ï¼Œç”¨ ?group=xxx æ¥é€‰æ‹©ä½¿ç”¨çš„ group
			- nacos:common.properties?group=order		
			- nacos:database.properties?group=order
```

è¿™æ ·å†™æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæ¯ç§ç¯å¢ƒè¦åŠ è½½çš„é…ç½®æ–‡ä»¶çš„åå­—ä¸ä¸€æ ·ï¼Œé‚£å°±å¾—æ ¹æ®ç¯å¢ƒåå¤ä¿®æ”¹ï¼Œè¿™å¾ˆä¸æ–¹ä¾¿ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ `yml` æ–‡ä»¶ä¸­é€šè¿‡ `---` åˆ†éš”æ–‡æ¡£ï¼Œåˆ†éš”å‡ºä¸åŒç¯å¢ƒçš„é…ç½®ï¼Œå¦‚ä¸‹ï¼ˆæœ€ä½³å®è·µï¼‰ï¼š

```yml
server:
	port: 8080
spring:
	profiles:
		active: dev		# è¿™æ˜¯ spring ä¸­ç”¨äºæ¿€æ´»æŒ‡å®šé…ç½®ç¯å¢ƒçš„é…ç½®é¡¹
						# é»˜è®¤è¡Œä¸ºæ˜¯æ¿€æ´» src/main/resources/ ä¸‹çš„ application-dev.yml
	application:
		name: service-order			# è¦æ³¨å†Œä¸ºçš„å¾®æœåŠ¡å
	cloud: 
		nacos:
			server-addr: 127.0.0.1:8848
			config:
				namespace: ${spring.profiles.active:public}		# é€‰æ‹©å‘½åç©ºé—´
				
---
spring: 
	config:
		import:
			# ç±»ä¼¼ http è¯·æ±‚ä¼ å‚çš„å½¢å¼ï¼Œç”¨ ?group=xxx æ¥é€‰æ‹©ä½¿ç”¨çš„ group
			- nacos:common.properties?group=order		
			- nacos:database.properties?group=order
		active:
			on-profile: dev		# è‹¥å½“å‰æ¿€æ´»çš„é…ç½®ç¯å¢ƒä¸º devï¼Œåˆ™ import ä¸Šé¢çš„ä¸¤ä¸ªé…ç½®
								# å› æ­¤å¯ä»¥å¤šå†™å‡ ä¸ªï¼Œæ¯ä¸ªå•ç‹¬å¯¹åº”ä¸€ä¸ªç¯å¢ƒè¦ import çš„é…ç½®

---

spring:
	config:
		import:
			- nacos:common.properties?group=order		
			- nacos:database.properties?group=order
			- nacos:test.properties?group=product
		active:
			on-profile: test
	
    
---

spring:
	config:
		import:
			- nacos:common.properties?group=order
			- nacos:prod.properties?group=product
		active:
			on-profile: prod
	
```

### æ€»ç»“

![image-20251208192615627](.\image-20251208192615627.png)

## FeignClient

å‰é¢æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ RestTemplateï¼Œè¿™ç§å«åšâ€ç¼–ç¨‹å¼ REST å®¢æˆ·ç«¯â€œï¼Œä½¿ç”¨èµ·æ¥å¾ˆéº»çƒ¦ï¼Œéœ€è¦å†™å¤§é‡çš„ä»£ç ï¼Œè€Œ FeignClient æ˜¯ä¸€ç§â€å£°æ˜å¼ REST å®¢æˆ·ç«¯â€œï¼Œå®ƒé€šè¿‡æ³¨è§£é©±åŠ¨ï¼Œåœ¨æ³¨è§£ä¸­æŒ‡å®šè¿œç¨‹åœ°å€ã€è¯·æ±‚æ–¹å¼ã€æºå¸¦æ•°æ®ä¸ç»“æœè¿”å›ï¼Œå³å¯å®ç°è¿œç¨‹è°ƒç”¨ã€‚**FeignClient æ˜¯è‡ªåŠ¨è´Ÿè½½å‡è¡¡çš„ï¼ŒFeign æ˜¯ HTTP å®¢æˆ·ç«¯ï¼Œä¸æ˜¯ RPCï¼Œåªèƒ½è°ƒç”¨å…¶ä»–å¾®æœåŠ¡ä¸­ Controller ä¸­æš´éœ²çš„æ–¹æ³•**ã€‚

### å®ç°æ­¥éª¤

1. åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  `@EnableFeignClients` æ³¨è§£

2. åˆ›å»ºä¸€ä¸ªç”¨äºå‘é€è¿œç¨‹è°ƒç”¨è¯·æ±‚çš„å®¢æˆ·ç«¯

   - åˆ›å»ºä¸€ä¸ªæ¥å£

   - åœ¨æ¥å£ä¸Šæ·»åŠ  `@FeignClient(value = "service-product")` æ³¨è§£ï¼Œvalue å€¼ä¸ºå¾®æœåŠ¡çš„åå­—ï¼Œç„¶ååˆ›å»ºæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ  `@GetMapping("/product/{id}")` æ³¨è§£

     - ```java
       @FeignClient(value = "service-product")
       public interface ProductFeignClient{
           // GetMapping è¿™æ ·çš„ MVC æ³¨è§£ï¼Œåœ¨ @Controller çš„ç±»ä¸­ï¼Œæ˜¯æŒ‡è®©åº”ç”¨æ¥å—è¯·æ±‚
           // è€Œåœ¨ @FeignClient ä¸­ï¼Œæ˜¯æŒ‡è®©åº”ç”¨å‘é€è¯·æ±‚
           @GetMapping("/product/{id}")
           Product getProductById(@PathVariable("id") Long id);
       }
       ```

     - `@FeignClient(value = "service-product")` ä¸­ï¼Œå¦‚æœä¸å†™ `contextId =`ï¼Œé‚£ä¹ˆè¿™ä¸ª Feign å®¢æˆ·ç«¯çš„åå­—å°±æ˜¯ `value` çš„å€¼ï¼Œå¦åˆ™å°±æ˜¯ `contextId` çš„å€¼

   - ç„¶åå°±å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ª FeignClient æ¥å£è¿œç¨‹è°ƒç”¨äº†

     - ```java
       @Autowired
       ProductFeignClient productFeignClient;
       
       Product product = productFeignClient.getProductById(1);
       ```



FeignClient ä¹Ÿå¯ä»¥è°ƒç”¨ç¬¬ä¸‰æ–¹çš„ APIï¼š

```java
// å¦‚æœå†™äº†urlï¼Œå°±æ˜¯æŒ‡å®šç»™è¿™ä¸ªåœ°å€å‘é€è¯·æ±‚ï¼Œå¯ä»¥éšä¾¿å†™ä¸€ä¸ªvalue
// å¦‚æœæ²¡æœ‰ç»™urlï¼Œé‚£å°±æ˜¯ç»™valueè¿™ä¸ªå¾®æœåŠ¡å‘é€è¯·æ±‚ï¼ŒFeignå°±ä¼šè‡ªåŠ¨è¿ä¸Šæ³¨å†Œä¸­å¿ƒ
@FeignClient(value = "weather-service", url = "http://baidu.com") 
public interface WeatherFeignClient{
    
    @PostMapping("/search")
    String search(@RequestHeader("Authentication") String auth,
                 @RequestParam("token") String token,
                 @RequestParam("question") String question);
}
```

### è¶…æ—¶æ§åˆ¶

è¶…æ—¶æ§åˆ¶å¯ä»¥é¿å…ç”±äºä¸€ä¸ªå¾®æœåŠ¡çš„å®•æœºå¯¼è‡´è°ƒç”¨æ–¹æŒç»­ç­‰å¾…ã€ä¸æ–­ç§¯å‹ã€æœ€ç»ˆè°ƒç”¨æ–¹è‡ªèº«ä¹Ÿæ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚ã€å¯¼è‡´æ•´ä¸ªé“¾è·¯é›ªå´©çš„é—®é¢˜ 

è¶…æ—¶æœ‰ä¸¤ç§ï¼š

1. è¿æ¥è¶…æ—¶ `connectionTimeout`ï¼šè°ƒç”¨æ–¹åœ¨å‘é€ http è¯·æ±‚æ—¶ï¼Œéœ€è¦å…ˆä¸è¢«è°ƒç”¨æ–¹å»ºç«‹è¿æ¥ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¶…æ—¶å°±æ˜¯è¿æ¥è¶…æ—¶ï¼Œé»˜è®¤é…é¥°ä¸º 10s
2. è¯»å–è¶…æ—¶ `readTimeout`ï¼šè°ƒç”¨æ–¹ä¸è¢«è°ƒç”¨æ–¹å»ºç«‹è¿æ¥åï¼Œå‘è¢«è°ƒç”¨æ–¹å‘é€è¯·æ±‚ï¼Œç„¶åç­‰å¾…è¢«è°ƒç”¨æ–¹å¤„ç†ä¸šåŠ¡æ•°æ®åå°†ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹ï¼Œåœ¨è¿™ä¸ªç­‰å¾…çš„è¿‡ç¨‹ä¸­è¶…æ—¶å°±æ˜¯è¯»å–è¶…æ—¶ï¼Œé»˜è®¤é…ç½®ä¸º 60s

#### é…ç½®æ–¹æ³•

```yml
spring:
	cloud:
		openfeign:
			client:
				config:
					default: 			# é»˜è®¤é…ç½®
						connect-timeout: 1000 	# ms
						read-timeout: 2000
					service-product:	# feign å®¢æˆ·ç«¯çš„åå­—ï¼Œä¸Šé¢æœ‰å†™æ€ä¹ˆé…ç½®
						connect-timeout: 3000 	# ms
						read-timeout: 5000
```

### é‡è¯•æœºåˆ¶

FeignClient é»˜è®¤æ˜¯ä¸é‡è¯•çš„ï¼Œå› æ­¤éœ€è¦è‡ªå·±é…ç½®

### æ‹¦æˆªå™¨

åˆ†ä¸ºè¯·æ±‚æ‹¦æˆªå™¨å’Œå“åº”æ‹¦æˆªå™¨ã€‚é¡¾åæ€ä¹‰ï¼Œè¯·æ±‚æ‹¦æˆªå™¨å°±æ˜¯ä¼šæ‹¦æˆªè¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹åå†å‘é€ï¼›å“åº”æ‹¦æˆªå™¨åˆ™æ˜¯ç”¨äºä¿®æ”¹å“åº”ï¼Œç„¶åå†è¿”å›ç»™è°ƒç”¨è€…ï¼Œä¸€èˆ¬ç”¨äºå“åº”é¢„å¤„ç†ã€‚

